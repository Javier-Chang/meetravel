$(function () {
    if ($(window).width() < 1125) {
        $('.megaMenu-hover').mouseover(function () {
            $('.megaMenu-tour').hide();
        });
    } else {
        var count = 0;
        $('.megaMenu-hover, .megaMenu-tour').mouseenter(function () {
            count++;
            setTimeout(function () {
                $('.megaMenu-tour').slideDown();
            }, 500);
        }).mouseleave(function () {
            count--;
            setTimeout(function () {
                if (count == 0) {
                    $('.megaMenu-tour').slideUp();
                }
            }, 1000);
        });
    }
});
$(function () {
    if ($(window).width() < 1125) {
        $('.clickme').click(function () {
            $(this).parent().find('.footer-ul').slideToggle('slow');
            $(this).parent().find('h6').toggleClass('special');
        });
    }
});
$('#back-top').hide();
$(function () {
    $(window).scroll(function () {
        if ($(this).scrollTop() > 200) {
            $('#back-top').fadeIn();
        } else {
            $('#back-top').fadeOut();
        }
    });
    $('#back-top a').on('click', function () {
        $('body,html').animate({
            scrollTop: 0
        }, 600);
        return false;
    });
});
$(document).ready(function () {
    if($('input[name=trip]:checked').val() === "1"){
        $('.one-way-ticket').show();
        $('.return-ticket').hide();
        $('.multi-ticket').hide();
    }
    else if($('input[name=trip]:checked').val() === "2"){
        $('.return-ticket').show();
        $('.one-way-ticket').hide();
        $('.multi-ticket').hide();
    }
    else if($('input[name=trip]:checked').val() === "3"){
        $('.return-ticket').hide();
        $('.one-way-ticket').hide();
        $('.multi-ticket').show();
    }

    var flight_route_chk = 0;
    $('input[name=trip]').click(function () {
        idName = $(this).attr('value');
        var windowSize = $(window).width();
        if ($(this).is(':checked')) {
            if (idName === '2') {
                $('.return-ticket').slideDown();
                flight_route_chk = 1;
            } else {
                $('.return-ticket').slideUp();
            }
            if (idName === '1') {
                $('.one-way-ticket').slideDown();
                flight_route_chk = 2;
            } else {
                $('.one-way-ticket').slideUp();
            }
            if (idName === '3') {
                if (windowSize >= 1024) {
                    $('.searchBox').css('width', 'calc(100% - 30px)');
                    $('.searchBox').css('z-index', '16');
                }
                $('.multi-ticket').slideDown();
                flight_route_chk = 3;
            } else {
                if (windowSize >= 1024) {
                    $('.searchBox').css('width', '55%');
                }
                $('.multi-ticket').slideUp();
            }
        }
    });
    $('#group, #room-reserve, #free-go').click(function () {
        var windowSize = $(window).width();
        if (windowSize >= 1024) {
            $('.searchBox').css('width', '55%');
        }
    });
    $('#ticket').click(function () {
        var windowSize = $(window).width();
        if (flight_route_chk === 3 && windowSize >= 1024) {
            $('.searchBox').css('width', 'calc(100% - 30px)');
            $('.searchBox').css('z-index', '16');
        }
    });
});
$(document).ready(function () {
    $('.select').select2({
        theme: 'bootstrap'
    });
});
$(document).ready(function () {

    let lang = $('html').attr('lang');
    $('.datepicker-start').datepicker({
        startDate: '0d',
        format: 'yyyy-mm-dd',
        autoclose: true,
        language: (lang == 'en') ? 'en': 'zh-TW'
    });
    $('.datepicker-end').datepicker({
        startDate: '0d',
        format: 'yyyy-mm-dd',
        autoclose: true,
        language: (lang == 'en') ? 'en': 'zh-TW'
    });

    //    initialization if the page refresh
    var date1 = $('#id_date_start2').datepicker('getDate');
    var date2 = $('#id_date_end2').datepicker('getDate');

    if (((date2 - date1) > 0) && (date1 != null) && (date2 != null)) {
        time_difference = parseInt(Math.abs(date2 - date1) / (1000 * 60 * 60 * 24));
        $('#total_date').text(time_difference);
    }

    $("#id_date_start2").on("changeDate", function (e) {
        $('#id_date_end2').datepicker("setStartDate", e.date);
    });
    $("#id_date_end2").on("changeDate", function (e) {
        $('#id_date_start2').datepicker("setEndDate", e.date);
    });

    // using in flight-search
    $("#id_date_start2, #id_date_end2").on("changeDate", function(e) {

        var date1 = $('#id_date_start2').datepicker('getDate');
        var date2 = $('#id_date_end2').datepicker('getDate');

        if (((date2 - date1) > 0) && (date1 != null) && (date2 != null)) {
            time_difference = parseInt(Math.abs(date2 - date1) / (1000 * 60 * 60 * 24));
            $('#total_date').text(time_difference);
        }else{
            $('#total_date').text("   ");
        }
    });
});
$(document).ready(function () {
    $('.bus-datepicker-input').datepicker({
        startDate: '0d',
        format: 'yyyy-mm-dd',
        autoclose: true,
        locale: 'zh-tw',
        language: 'zh-TW'
    });
    $(".bus-datepicker-start").on("changeDate", function (e) {
        $('.bus-datepicker-end').datepicker("setStartDate", e.date);
    });
    $(".bus-datepicker-end").on("changeDate", function (e) {
        $('.bus-datepicker-start').datepicker("setEndDate", e.date);
    });
});
$(document).ready(function () {
    $('.datepicker-birthdate').datepicker({
        startDate: '1900-01-01',
        endDate: '0d',
        format: 'yyyy-mm-dd',
        autoclose: true,
        locale: 'zh-tw',
        language: 'zh-TW'
    });
});
/*
$(document).ready(function () {
    $('.datetimepicker').datetimepicker({
        minDate: moment().millisecond(0).second(0).minute(0).hour(0),
        useCurrent: false,
        format: 'L',
        format: 'YYYY-MM-DD',
        ignoreReadonly: true,
        allowInputToggle: true,
        locale: 'zh-tw',
        debug: true
    });
    $(".datetimepicker-start").on("dp.change", function (e) {
        $('.datetimepicker-end').data("DateTimePicker").minDate(e.date);
    });
    $(".datetimepicker-end").on("dp.change", function (e) {
        $('.datetimepicker-start').data("DateTimePicker").maxDate(e.date);
    });
});
$(document).ready(function () {
    $('.datetimepicker-birthdate').datetimepicker({
        minDate: moment().millisecond(0).second(0).minute(0).hour(0).year(1900),
        maxDate: moment().millisecond(0).second(0).minute(0).hour(0),
        useCurrent: false,
        format: 'L',
        format: 'YYYY-MM-DD',
        ignoreReadonly: true,
        allowInputToggle: true,
        locale: 'zh-tw',
        debug: true
    });
});
*/
var accordPanels = $('.accordion > dd').hide();
$('.accordion').on('click', 'dt > a', function () {
    var current = $(this).parent().next('dd');
    $('.accordion > dt > a').removeClass('active');
    $(this).addClass('active');
    accordPanels.not(current).slideUp('easeInExpo');
    $(this).parent().next().slideDown('easeOutExpo');
    return false;
});
$('a[href=flightTerminal]').click(function () {
    $('div.faq-container').hide();
    $('div.flight-container').show();
    $('a[href=flightTerminal] > .serviceBox').addClass('active');
    $('a[href=faq] > .serviceBox').removeClass('active');
    return false;
});
$('a[href=faq]').click(function () {
    $('div.flight-container').hide();
    $('div.faq-container').show();
    $('a[href=faq] > .serviceBox').addClass('active');
    $('a[href=flightTerminal] > .serviceBox').removeClass('active');
    return false;
});
$('a[href=tripPlan]').click(function () {
    $('div.feedback-container').hide();
    $('div.tripPlan-container').show();
    $('a[href=tripPlan] > .serviceBox').addClass('active');
    $('a[href=feedback] > .serviceBox').removeClass('active');
    return false;
});
$('a[href=feedback]').click(function () {
    $('div.tripPlan-container').hide();
    $('div.feedback-container').show();
    $('a[href=feedback] > .serviceBox').addClass('active');
    $('a[href=tripPlan] > .serviceBox').removeClass('active');
    return false;
});
$(document).ready(function () {
    $('.passenger').hide();
    $('.departureTimes').hide();
    $('.othersTour').hide();
    $('.othersArea').hide();
    $('input[name=car-service]').click(function () {
        valueNumber = $(this).attr('value');
        if ($(this).is(':checked')) {
            if (valueNumber === '2') {
                $('.passenger').slideDown();
            } else {
                $('.passenger').slideUp();
            }
        }
    });
    $('input[name=depart-style]').click(function () {
        valueNumber = $(this).attr('value');
        if ($(this).is(':checked')) {
            if (valueNumber === '2') {
                $('.departureTimes').slideDown();
            } else {
                $('.departureTimes').slideUp();
            }
        }
    });
    $('input[name=tour-style]').click(function () {
        valueNumber = $(this).attr('value');
        if ($(this).is(':checked')) {
            if (valueNumber === '5') {
                $('.othersTour').slideDown();
            } else {
                $('.othersTour').slideUp();
            }
        }
    });
    $('.tourCode').show();
    $('.tourFile').hide();
    $('.noFile').hide();
    $('input[name=tour-price]').click(function () {
        valueNumber = $(this).attr('value');
        if ($(this).is(':checked')) {
            if (valueNumber === '1') {
                $('.tourCode').slideDown();
            } else {
                $('.tourCode').slideUp();
            }
        }
    });
    $('input[name=tour-price]').click(function () {
        valueNumber = $(this).attr('value');
        if ($(this).is(':checked')) {
            if (valueNumber === '2') {
                $('.tourFile').slideDown();
            } else {
                $('.tourFile').slideUp();
            }
        }
    });
    $('input[name=tour-price]').click(function () {
        valueNumber = $(this).attr('value');
        if ($(this).is(':checked')) {
            if (valueNumber === '3') {
                $('.noFile').slideDown();
            } else {
                $('.noFile').slideUp();
            }
        }
    });
});
$('a.smooth-scroll[href^="#"]').on('click', function (event) {
    var target = $($(this).attr('href'));
    if (target.length) {
        event.preventDefault();
        $('html, body').animate({
            scrollTop: target.offset().top
        }, 600);
    }
});
$(function () {
    $('#orderContract').hide();
    $('#readContract').click(function () {
        $('#orderContract').slideToggle();
    });
});


//Payment Form 控制 ===================================================

function deactivatePaymentForm() {
    $('input[name=amount_type]').prop('required', false);
    $('input[name=provider]').prop('required', false);
}
function deactivateReceiptForm() {
    $('input[name=recipient_type]').prop('required', false);
    $('input[name=taiwan_company_id]').prop('required', false);
    $('input[name=company_name]').prop('required', false);
}
$(document).ready(function () {

    // 展開收合旅客資料
    $('div[id^="traveler-wirte"]').hide();
    $('input[name^=traveler]').change(function () {
        seq = this.name.substr(-1);
        if (this.value == "1") {
            $("#traveler-wirte"+seq).slideDown();
        } else {
            $("#traveler-wirte"+seq).slideUp();
        }
    });

    // 展開收合 飲食偏好(其他)
    $('.food>select').change(function () {
        seq = parseInt(this.id[8])+1;
        if (this.value == "1") {
            $("#foodOthers"+seq).slideDown();
        } else {
            $("#foodOthers"+seq).slideUp();
        }
    });
    $('.food>select').change()

    // 選擇是否現在付款時 展開收合 付款表單
    $('input[name=pay_now]').change(function () {
        if (this.checked && this.value == '1') {  // 現在付款
            $("#payment_form").slideDown();
            $('input[name=amount_type]').prop('required', true);
            $('input[name=provider]').prop('required', true);
            $('input[name=amount_type]:checked').change()
        } else if (this.checked && this.value == '0') {  // 現在不付
            $("#payment_form").slideUp();
            $("#receipt_form").slideUp();
            deactivatePaymentForm()
            deactivateReceiptForm()
       }
    });

    // 選擇付清/訂金時 展開收合 代轉收據資料表單
    $('input[name=amount_type]').change(function () {
        if (this.checked && this.value == '1') { // 付全額時需填代轉表單
            $("#receipt_form").slideDown();
            $('input[name=recipient_type]').prop('required', true);
            $('input[name=recipient_type]:checked').change()
        } else if (this.checked && this.value == '2') { // 付訂金時不用填
            $("#receipt_form").slideUp();
            deactivateReceiptForm()
       }
    });

    // 選擇買受人種類時 展開收合 代轉表單裡的 公司資訊欄位
    $('input[name=recipient_type]').change(function () {
        if (this.checked && this.value == '1') { // 個人
            $("#company").slideUp();
            $('input[name=taiwan_company_id]').prop('required', false);
            $('input[name=company_name]').prop('required', false);
        } else if (this.checked && this.value == '2') { // 公司
            $("#company").slideDown();
            $('input[name=taiwan_company_id]').prop('required', true);
            $('input[name=company_name]').prop('required', true);
       }
    });
    
    // 點數限制相關
    $('input[name=point]').on('input', function() {
        var paymentAmount = $('input[name=amount_type]:checked').closest('label').text().match(/\d+/)[0];

        var maxPoints = Math.min(userPoints, paymentAmount);
        if(this.value > maxPoints){
            this.value = maxPoints;
        }

        if(this.value == paymentAmount){
            $("input[name=provider]").each(
                function(){
                    $(this).removeAttr('required');
                    $(this).prop('checked', false);
                    $(this).prop('disabled', true);
                }
            );
            $("#provider_options").slideUp()
            $("#amount_minus_points").text("")
        }else{
            $("input[name=provider]").each(
                function(){
                    $(this).attr('required', '');
                    $(this).prop('disabled', false);
                }
            );
            $("#provider_options").slideDown()
            $("#amount_minus_points").text("尚需支付"+(paymentAmount-this.value)+"元")
        }
    });

    $('input[name=amount_type]').change(function () {
        $('input[name=point]').trigger("input");

        var paymentAmount = $('input[name=amount_type]:checked').closest('label').text().match(/\d+/)[0];
        var maxPoints = Math.min(userPoints, paymentAmount);
        $('input[name=point]').attr('max', maxPoints);
    });


});
//==============================================================================

function preventDefault(e) {
    e = e || window.event;
    if (e.preventDefault) {
        e.preventDefault();
        e.returnValue = false;
    }
}
/*
$(function () {
    $(".owl-carousel").hammer().on("swipeleft swiperight", function swipeHandler(event) {
        document.addEventListener('touchmove', preventDefault, {
            passive: false
        });
        setTimeout(function () {
            document.removeEventListener('touchmove', preventDefault, {
                passive: false
            });
        }, 1600);
    });
});
*/
$(document).ready(function () {
    $(function () {
        $('#tour-features-btn, #daily-tour-btn, #flight-info-btn, #extra-charges-btn, #tour-alert-info-btn, #hotel-info-btn').click(function () {
            $('html,body').animate({
                scrollTop: $('#tabTop').offset().top
            }, 500);
        });
    });
});
$(document).ready(function () {
    $(function () {
        $('[href="#option-section"]').click(function () {
            $('html,body').animate({
                scrollTop: $('#option-section').offset().top
            }, 500);
        });
    });
});

// for navbar burger
$(document).ready(function(){
    $(".menu-offcanvas-collaspe").click(function () {
        $(this).find("i.fas.fa-chevron-down").toggleClass("flip");
    });
})
